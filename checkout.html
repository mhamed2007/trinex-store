<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRINEX | Checkout</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;700&family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg-color: #000000; --text-color: #ffffff; --green-btn: #00e676; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; padding-top: 80px; }
        
        /* Navbar */
        nav { background: rgba(0,0,0,0.95); border-bottom: 1px solid #222; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; width: 100%; z-index: 1000; }
        .brand-text { font-family: 'Montserrat'; font-size: 1.5rem; font-weight: 900; color: #fff; text-decoration: none; }
        
        .container { max-width: 600px; margin: 40px auto; background: #0a0a0a; padding: 30px; border-radius: 10px; border: 1px solid #333; }
        h1 { text-align: center; color: var(--green-btn); font-family: 'Montserrat'; }
        
        .order-summary { background: #151515; padding: 15px; margin-bottom: 20px; border-right: 4px solid var(--green-btn); font-size: 0.9rem; color: #ccc; }
        .auto-fill-badge { background: rgba(0, 230, 118, 0.1); color: var(--green-btn); padding: 10px; border-radius: 5px; text-align: center; display: none; margin-bottom: 20px; }
        
        .form-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 5px; box-sizing: border-box; }
        .submit-btn { width: 100%; padding: 15px; background: var(--green-btn); color: #000; border: none; font-weight: bold; font-size: 1.1rem; border-radius: 5px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <nav><a href="index.html" class="brand-text">TRINEX</a></nav>

    <div class="container">
        <h1>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸ›’</h1>
        
        <div id="orderList" class="order-summary">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©...
        </div>

        <div id="autoMsg" class="auto-fill-badge">âœ¨ ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>

        <form onsubmit="sendOrder(event)">
            <div class="form-group"><input type="text" id="fullName" placeholder="Ø§Ù„Ø§Ø³Ù…" required></div>
            <div class="form-group"><input type="tel" id="phone1" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" required></div>
            <div class="form-group"><input type="tel" id="phone2" placeholder="Ø±Ù‚Ù… Ø§Ø­ØªÙŠØ§Ø·ÙŠ"></div>
            <div class="form-group"><textarea id="address" rows="3" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required></textarea></div>
            <button type="submit" class="submit-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨) <i class="fab fa-whatsapp"></i></button>
        </form>
    </div>

    <script>
        let cart = [];

        window.onload = function() {
            // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø³Ù„Ø©
            cart = JSON.parse(localStorage.getItem('trinex_cart')) || [];
            let listDiv = document.getElementById('orderList');
            
            if(cart.length === 0) {
                listDiv.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!";
            } else {
                let total = 0;
                let html = "<strong>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong><br><br>";
                cart.forEach(item => {
                    let sub = item.price * item.qty;
                    total += sub;
                    html += `â€¢ ${item.product} (${item.color}, ${item.size}) x${item.qty} = ${sub} EGP<br>`;
                });
                html += `<br><strong style="color:#fff; font-size:1.1rem;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} EGP</strong>`;
                listDiv.innerHTML = html;
            }

            // 2. Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            let savedInfo = JSON.parse(localStorage.getItem('trinex_saved_info'));
            if(savedInfo) {
                document.getElementById('fullName').value = savedInfo.name || "";
                document.getElementById('phone1').value = savedInfo.phone || "";
                document.getElementById('phone2').value = savedInfo.phone2 || "";
                document.getElementById('address').value = savedInfo.address || "";
                document.getElementById('autoMsg').style.display = 'block';
            }
        };

        function sendOrder(e) {
            e.preventDefault();
            if(cart.length === 0) { alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!"); return; }

            let name = document.getElementById('fullName').value;
            let p1 = document.getElementById('phone1').value;
            let p2 = document.getElementById('phone2').value;
            let addr = document.getElementById('address').value;

            // ØªØ¬Ù‡ÙŠØ² Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            let itemsText = cart.map(i => `â–ªï¸ ${i.product} (${i.color}, ${i.size}) - Ø§Ù„Ø¹Ø¯Ø¯: ${i.qty}`).join('%0a');
            let total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);

            let myNumber = "201114519866";
            let msg = `ğŸ›’ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹*%0a` +
                      `-----------------------%0a` +
                      `${itemsText}%0a` +
                      `-----------------------%0a` +
                      `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${total} EGP%0a` +
                      `ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}%0a` +
                      `ğŸ“± *Ù…ÙˆØ¨Ø§ÙŠÙ„:* ${p1}%0a` +
                      `ğŸ“ *Ø§Ø­ØªÙŠØ§Ø·ÙŠ:* ${p2}%0a` +
                      `ğŸ  *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${addr}`;

            // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ø¨Ø³ Ø£ÙØ¶Ù„)
            localStorage.removeItem('trinex_cart');
            
            window.open(`https://wa.me/${myNumber}?text=${msg}`, '_blank');
            window.location.href = "index.html"; // Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        }
    </script>
</body>
</html>
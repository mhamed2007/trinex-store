<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRINEX | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;700&family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Cairo'; text-align: center; padding: 50px 20px; }
        .login-box { max-width: 400px; margin: 0 auto; background: #111; padding: 30px; border-radius: 10px; border: 1px solid #333; }
        h1 { font-family: 'Montserrat'; color: #00e676; margin-bottom: 30px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; font-family: 'Cairo'; }
        button { width: 100%; padding: 12px; background: #00e676; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 1.1rem; }
        button:hover { background: #00c853; }
        p { font-size: 0.9rem; color: #888; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="login-box">
        <h1>ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¶ÙˆÙŠØ©</h1>
        <p>Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ø´Ø§Ù† ØªÙ‚Ø¯Ø± ØªØªØ§Ø¨Ø¹ Ø§Ù„Ø¹Ø±ÙˆØ¶.</p>
        
        <input type="text" id="username" placeholder="Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)" required>
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        
        <button id="regBtn" onclick="registerUser()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙˆØªØ³Ø¬ÙŠÙ„ ðŸš€</button>
        <p id="statusMsg"></p>
    </div>

    <script type="module">
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù…Ù† Ø¬ÙˆØ¬Ù„
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ø§Ù„Ù„ÙŠ Ø§Ù†Øª Ø¨Ø¹ØªÙ‡Ø§)
        const firebaseConfig = {
            apiKey: "AIzaSyDpC3kyBhy-mWsYjVAHxUuy2pqg_Sh0Z8U",
            authDomain: "trinex-store.firebaseapp.com",
            projectId: "trinex-store",
            storageBucket: "trinex-store.firebasestorage.app",
            messagingSenderId: "265387866506",
            appId: "1:265387866506:web:1fb7786e186cf0abf43073"
        };

        // ØªØ´ØºÙŠÙ„ Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        window.registerUser = async function() {
            let phone = document.getElementById('phone').value;
            let pass = document.getElementById('password').value;
            let name = document.getElementById('username').value;
            let btn = document.getElementById('regBtn');
            let status = document.getElementById('statusMsg');

            if(phone.length < 11 || pass.length < 4) {
                alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ ØµØ­ÙŠØ­ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©");
                return;
            }

            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
            btn.disabled = true;

            try {
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø¬ÙˆØ¬Ù„
                await addDoc(collection(db, "customers"), {
                    name: name,
                    phone: phone,
                    password: pass, // ØªÙ†Ø¨ÙŠÙ‡: ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¨Ù†Ø´ÙØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
                    createdAt: serverTimestamp() // ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                });

                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
                localStorage.setItem('trinex_user_logged', 'true');
                localStorage.setItem('trinex_user_phone', phone);

                status.style.color = "#00e676";
                status.innerText = "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...";

                // Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                let myNumber = "201114519866";
                let msg = `ðŸ‘¤ *Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹*%0aØ§Ù„Ø§Ø³Ù…: ${name}%0aØ§Ù„Ø±Ù‚Ù…: ${phone}`;
                window.open(`https://wa.me/${myNumber}?text=${msg}`, '_blank');

                setTimeout(() => { window.location.href = "index.html"; }, 2000);

            } catch (e) {
                console.error("Error adding document: ", e);
                status.style.color = "red";
                status.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
                btn.disabled = false;
                btn.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
            }
        }
    </script>
</body>
</html>